from bs4 import BeautifulSoup
import xml.etree.cElementTree as et
import requests
import csv
import json


def csv_file_writer(list_of_links):
    """Writes a csv file with the name active_malware_file"""
    with open("active_malwares_file.csv", 'w', newline='') as f:
        writer = csv.writer(f)
        writer.writerow(['Links'])
        writer.writerows(list_of_links)


def xml_file_writer(list_of_links):
    """Writes a xml file with the name active_malware_file"""
    root = et.Element("links")
    for link in list_of_links:
        et.SubElement(root, "link").text = link
    tree = et.ElementTree(root)
    tree.write("active_malwares_file.xml", encoding='utf-8', xml_declaration=True)


def json_file_writer(list_of_links):
    """Writes a json file with the name active_malware_file"""
    with open('active_malwares_file.json', 'w', encoding='utf-8') as f:
        json.dump(list_of_links, f, ensure_ascii=False, indent=4)


def main():
    """Displays a menu with the options to download a file in a specific format"""
    source = requests.get('https://urlhaus.abuse.ch/downloads/text/').text
    soup = BeautifulSoup(source, 'lxml')
    plain_text = soup.find('p').text
    list_of_links = [item for item in plain_text.splitlines()[9:]]
    choice = '0'
    while choice == '0':
        print("Choose the format to download an active malware urls file")
        print("1. Csv")
        print("2. Json")
        print("3. Xml")
        print("4. SQLite Table")

        choice = input("Please make a choice: ")

        if choice == "4":
            print("active_malwares_file.sql downloaded!")
        elif choice == "3":
            xml_file_writer(list_of_links)
            print("active_malwares_file.xml downloaded!")
        elif choice == "2":
            print("active_malwares_file.json downloaded!")
            json_file_writer(list_of_links)
        elif choice == "1":
            csv_file_writer(list_of_links)
            print("active_malwares_file.csv downloaded!")
        else:
            print("I don't understand your choice.")


main()
